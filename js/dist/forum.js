module.exports=function(e){var t={};function i(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=17)}([function(e,t){e.exports=flarum.core.compat["common/app"]},function(e,t){e.exports=flarum.core.compat.app},function(e,t){e.exports=flarum.core.compat["common/components/Button"]},function(e,t){e.exports=flarum.core.compat["common/Component"]},function(e,t,i){"use strict";function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}i.d(t,"a",(function(){return o}))},function(e,t){e.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(e,t){e.exports=flarum.core.compat["components/Button"]},function(e,t){e.exports=flarum.extensions["fof-upload"]},function(e,t){e.exports=flarum.core.compat["common/utils/classList"]},function(e,t){e.exports=flarum.core.compat["common/extend"]},function(e,t){e.exports=flarum.core.compat["common/components/Alert"]},function(e,t){e.exports=flarum.core.compat["common/utils/extractText"]},function(e,t){e.exports=flarum.core.compat["common/utils/Stream"]},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DropZone}));var _babel_runtime_helpers_esm_inheritsLoose__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),flarum_common_app__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(flarum_common_app__WEBPACK_IMPORTED_MODULE_1__),flarum_common_Component__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),flarum_common_Component__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(flarum_common_Component__WEBPACK_IMPORTED_MODULE_2__),_UserFileList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15),flarum_common_components_Button__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),flarum_common_components_Button__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(flarum_common_components_Button__WEBPACK_IMPORTED_MODULE_4__),flarum_common_utils_Stream__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(12),flarum_common_utils_Stream__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(flarum_common_utils_Stream__WEBPACK_IMPORTED_MODULE_5__),DropZone=function(_Component){function DropZone(){return _Component.apply(this,arguments)||this}Object(_babel_runtime_helpers_esm_inheritsLoose__WEBPACK_IMPORTED_MODULE_0__.a)(DropZone,_Component);var _proto=DropZone.prototype;return _proto.oninit=function(e){_Component.prototype.oninit.call(this,e),this.uploaded=!1,this.enable=!1,this.loading=!1,this.content="",this.files="",this.text_original=flarum_common_utils_Stream__WEBPACK_IMPORTED_MODULE_5___default()(!!this.attrs.text_original),this.text_transliterat=flarum_common_utils_Stream__WEBPACK_IMPORTED_MODULE_5___default()(!!this.attrs.text_transliterat),this.files="",this.contor=0},_proto.view=function(){var e=this;return 0!=this.attrs.selectedFiles.length?this.uploaded=!0:this.uploaded=!1,flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.fileListState.files.map((function(t){e.attrs.selectedFiles.includes(t.id())&&((t.type().includes("image/")||"application/pdf"===t.type())&&e.contor++,0!=e.contor?e.enable=!0:e.enable=!1)})),m("div",null,this.loading&&m("div",{className:"div_loading"},m("img",{src:"https://digi.emoldova.org/assets/files/2021-04-29/1619697698-204093-cyr-ocr-animation.gif"})),m("div",{className:"NoDropZone"},this.uploaded&&_UserFileList__WEBPACK_IMPORTED_MODULE_3__.a.component({user:this.attrs.user,selectable:!0,onFileSelect:this.attrs.onFileSelect.bind(this),selectedFiles:this.attrs.selectedFiles,restrictFileType:this.attrs.restrictFileType}),this.uploaded&&m("div",{className:"UserFileList-buttons"},""==this.files?flarum_common_components_Button__WEBPACK_IMPORTED_MODULE_4___default.a.component({className:"Button Button--primary button_transliterare",onclick:this.transliterate.bind(this),disabled:!this.enable,loading:this.loading},flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.translator.trans("digi-media-manager.forum.dropzone.transliterate_button")):"",this.files&&m("div",{className:"UserFileList-text"},m("h3",{class:!0},"Textul din imagine a fost recunoscut si transliterat. Selecteaza textul/textele pentru a continua."),m("div",{className:"Form-group"},m("div",null,m("label",{className:"checkbox"},m("input",{type:"checkbox",bidi:this.text_original,oncha:!0,disabled:this.loading}),flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.translator.trans("digi-media-manager.forum.dropzone.checkbox_text_original")),m("label",{className:"checkbox"},m("input",{type:"checkbox",bidi:this.text_transliterat,disabled:this.loading}),flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.translator.trans("digi-media-manager.forum.dropzone.checkbox_text_transliterat"))))),""!==this.files?flarum_common_components_Button__WEBPACK_IMPORTED_MODULE_4___default.a.component({className:"Button Button--primary button_transliterare",onclick:this.addFilesAndText.bind(this)},flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.translator.trans("digi-media-manager.forum.dropzone.add_to_composer_button")):"")),!this.uploaded&&m("div",{className:"dropzone"},m("div",{class:"icon-container"},m("i",{class:"far fa-file-image fa-4x"}),m("i",{class:"far fa-file-pdf fa-4x"}),m("i",{class:"far fa-file-alt fa-4x"})),m("h1",null,flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.translator.trans("digi-media-manager.forum.dropzone.title")),m("p",null,flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.translator.trans("digi-media-manager.forum.dropzone.subtitle"))))},_proto.transliterate=function transliterate(){var _this2=this;this.loading=!0,this.files="";var params={user_id:flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.session.user.id()},maxFileSize=0;if(flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.fileListState.files.map((function(file){_this2.attrs.selectedFiles.includes(file.id())&&(file.url().includes("imgur")||(file.type().includes("image/")||"application/pdf"===file.type())&&(eval("params.id_"+file.id()+" = "+file.id()),file.size()>maxFileSize&&(maxFileSize=file.size())))})),0===maxFileSize)return alert("One or more files no corresponding with requirement!"),this.loading=!1,void m.redraw();maxFileSize<5242880?setTimeout((function(){_this2.request(params)}),2e4):maxFileSize>=5242880&&maxFileSize<10485760?setTimeout((function(){_this2.request(params)}),9e4):maxFileSize>=10485760&&maxFileSize<15728640?setTimeout((function(){_this2.request(params)}),15e4):maxFileSize>=15728640&&maxFileSize<20971520?setTimeout((function(){_this2.request(params)}),3e5):maxFileSize>=20971520&&maxFileSize<26214400?setTimeout((function(){_this2.request(params)}),4e5):maxFileSize>=26214400&&maxFileSize<52428800?setTimeout((function(){_this2.request(params)}),5e5):maxFileSize>=52428800&&maxFileSize<104857600?setTimeout((function(){_this2.request(params)}),6e5):maxFileSize>=104857600&&maxFileSize<262144e3&&setTimeout((function(){_this2.request(params)}),12e5)},_proto.request=function(e){var t=this;return flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.request({method:"GET",url:flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.forum.attribute("apiUrl")+"/trans-texts",params:e}).then((function(e){t.files=e.data,t.loading=!1,m.redraw()})).catch((function(e){throw t.loading=!1,m.redraw(),e}))},_proto.addFilesAndText=function(){var e=this;flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.modal.close();var t=this.text_original(),i=this.text_transliterat(),a=0;this.attrs.selectedFiles.map((function(o){var n=flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.store.getById("files",o);try{n.id()===e.files[a].id&&(flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.composer.editor.insertAtCursor(n.bbcode()+"\n\n"),1==i&&flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.composer.editor.insertAtCursor("[transliterat]\n"+e.files[a].attributes.url+"\n[/transliterat]\n\n"),1==t&&flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.composer.editor.insertAtCursor("[chirilic]\n"+e.files[a].attributes.path+"\n[/chirilic]\n\n"),a++)}catch(e){a++,flarum_common_app__WEBPACK_IMPORTED_MODULE_1___default.a.composer.editor.insertAtCursor(n.bbcode()+"\n\n")}}))},DropZone}(flarum_common_Component__WEBPACK_IMPORTED_MODULE_2___default.a)},function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var a=i(4),o=i(3),n=i.n(o),s=i(2),l=i.n(s),r=i(10),_=i.n(r),u=i(5),c=i.n(u),p=i(8),d=i.n(p),f=i(11),h=i.n(f),b=["image/png","image/jpg","image/jpeg","image/svg+xml","image/gif"],g=["application/zip","application/x-7z-compressed","application/gzip","application/vnd.rar","application/x-rar-compressed"],E=["text/html","text/css","text/javascript","application/json","application/ld+json","text/javascript","application/x-httpd-php"],M=["application/x-abiword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf"];var O=function(e){function t(){return e.apply(this,arguments)||this}Object(a.a)(t,e);var i=t.prototype;return i.oninit=function(t){e.prototype.oninit.call(this,t),app.fileListState.setUser(t.attrs.user||app.session.user),this.inModal=t.attrs.selectable,this.restrictFileType=t.attrs.restrictFileType||null,this.downloadOnClick=this.attrs.downloadOnClick||!1,this.filesBeingHidden=[],this.user=app.fileListState.user,this.showFiles=this.attrs.selectedFiles},i.view=function(){var e=this,t=app.fileListState;return m("div",{className:"fof-upload-file-list","aria-live":"polite"},t.isLoading()&&0===t.files.length&&m("div",{className:"fof-upload-loading"},app.translator.trans("fof-upload.forum.file_list.loading"),m(c.a,null)),this.inModal&&t.empty()&&m("p",{className:"fof-upload-empty"},m("i",{className:"fas fa-cloud-upload-alt fof-upload-empty-icon"}),app.translator.trans("fof-upload.forum.file_list.modal_empty_"+("phone"!==app.screen()?"desktop":"phone"))),!this.inModal&&t.empty()&&m("p",{className:"fof-upload-empty"},app.translator.trans("fof-upload.forum.file_list.empty")),m("ul",null,t.files.map((function(t){if(e.showFiles.includes(t.id())){var i,a=(i=t.type(),b.includes(i)?"image":i.includes("image/")?"far fa-file-image":i.includes("video/")?"far fa-file-video":g.indexOf(i)>=0?"far fa-file-archive":"application/pdf"===i?"far fa-file-pdf":M.indexOf(i)>=0?"far fa-file-word":i.includes("audio/")?"far fa-file-audio":E.indexOf(i)>=0?"far fa-file-code":"far fa-file"),o=!e.restrictFileType||e.isSelectable(t),n=d()(["fof-file","image"===a&&"fof-file-type-image",e.attrs.selectedFiles&&e.attrs.selectedFiles.indexOf(t.id())>=0&&"fof-file-selected"]),s=t.baseName(),r=e.filesBeingHidden.includes(t.uuid());return m("li",{"aria-busy":r},app.session.user&&(e.user===app.session.user||app.session.user.deleteOthersMediaLibrary())&&m(l.a,{className:"Button Button--icon fof-file-delete",icon:"far fa-trash-alt","aria-label":app.translator.trans("fof-upload.forum.file_list.delete_file_a11y_label",{fileName:s}),disabled:r,onclick:e.hideFile.bind(e,t)}),m("button",{className:n,onclick:function(){return e.onFileClick(t)},disabled:!o||r,"aria-label":h()(app.translator.trans("fof-upload.forum.file_list.select_file_a11y_label",{fileName:s}))},m("figure",null,"image"===a?m("img",{src:t.url(),className:"fof-file-image-preview",draggable:!1,alt:""}):m("span",{className:"fof-file-icon",role:"presentation"},m("i",{className:"fa-fw "+a})),m("figcaption",{className:"fof-file-name"},s),r&&m("span",{class:"fof-file-loading",role:"status","aria-label":app.translator.trans("fof-upload.forum.file_list.hide_file.loading")},m(c.a,null)))))}}))))},i.onFileClick=function(e){this.attrs.onFileSelect?this.attrs.onFileSelect(e):this.attrs.downloadOnClick&&window.open(e.url())},i.isSelectable=function(e){var t=e.type();return Array.isArray(this.restrictFileType)?this.restrictFileType.indexOf(t)>=0:"image"===this.restrictFileType?t.includes("image/"):"audio"===this.restrictFileType?t.includes("audio/"):"video"===this.restrictFileType&&t.includes("video/")},i.hideFile=function(e){var t=this,i=e.uuid();if(!this.filesBeingHidden.includes(i))if(this.filesBeingHidden.push(i),confirm(h()(app.translator.trans("fof-upload.forum.file_list.hide_file.hide_confirmation",{fileName:e.baseName()}))))app.request({method:"PATCH",url:app.forum.attribute("apiUrl")+"/fof/upload/hide",body:{uuid:i}}).then((function(){app.alerts.show(_.a,{type:"success"},app.translator.trans("fof-upload.forum.file_list.hide_file.hide_success"))})).catch((function(){app.alerts.show(_.a,{type:"error"},app.translator.trans("fof-upload.forum.file_list.hide_file.hide_fail",{fileName:e.fileName()}))})).then((function(){var e=app.fileListState,a=e.files.findIndex((function(e){return i===e.uuid()}));e.files.splice(a,1);var o=t.filesBeingHidden.indexOf(i);t.filesBeingHidden.splice(o,1)}));else{var a=this.filesBeingHidden.indexOf(i);this.filesBeingHidden.splice(a,1)}},t}(n.a)},,function(e,t,i){"use strict";i.r(t);var a=i(9),o=i(6),n=i.n(o),s=i(4),l=i(0),r=i.n(l),_=i(3),u=i.n(_),c=i(2),p=i.n(c),d=i(5),f=i.n(d),h=i(8),b=i.n(h),g=function(e){function t(){return e.apply(this,arguments)||this}Object(s.a)(t,e);var i=t.prototype;return i.oninit=function(t){var i=this;e.prototype.oninit.call(this,t),this.attrs.uploader.on("uploaded",(function(){i.$("form")[0].reset(),m.redraw()})),this.isMediaUploadButton=t.attrs.isMediaUploadButton||!1},i.oncreate=function(t){e.prototype.oncreate.call(this,t),this.isMediaUploadButton||this.$().tooltip()},i.view=function(){var e=this.attrs.uploader.uploading?r.a.translator.trans("fof-upload.forum.states.loading"):r.a.translator.trans("fof-upload.forum.buttons.upload"),t=!this.isMediaUploadButton&&e||" ";return m(p.a,{className:b()(["Button","hasIcon","fof-upload-button",!this.isMediaUploadButton&&!this.attrs.uploader.uploading&&"Button--icon",!this.isMediaUploadButton&&!this.attrs.uploader.uploading&&"Button--link",this.attrs.uploader.uploading&&"uploading"]),icon:!this.attrs.uploader.uploading&&"fas fa-file-upload",onclick:this.uploadButtonClicked.bind(this),title:t,disabled:this.attrs.disabled},this.attrs.uploader.uploading&&m(f.a,{size:"tiny",className:"LoadingIndicator--inline Button-icon"}),(this.isMediaUploadButton||this.attrs.uploader.uploading)&&m("span",{className:"Button-label"},e),m("form",null,m("input",{type:"file",multiple:!0,onchange:this.process.bind(this)})))},i.process=function(e){var t=this.$("input").prop("files");0!==t.length&&this.attrs.uploader.upload(t,!this.isMediaUploadButton)},i.uploadButtonClicked=function(e){this.$("input").click()},t}(u.a),E=i(14),M=i(1),O=i.n(M);O.a.initializers.add("block-cat/digi-media-manager",(function(){Object(a.extend)(i(7).components.FileManagerModal.prototype,"oninit",(function(){O.a.forum.data.attributes.userFileListVisibility=!1})),Object(a.override)(i(7).components.FileManagerModal.prototype,"view",(function(e){return m("div",{className:"Modal modal-dialog "+this.className()},m("div",{className:"Modal-content"},m("div",{className:"fof-modal-buttons App-backControl"},m(g,{uploader:this.uploader,disabled:O.a.fileListState.isLoading(),isMediaUploadButton:!0})),m("div",{className:"fof-drag-and-drop"},m("div",{className:"fof-drag-and-drop-release"},m("i",{className:"fas fa-cloud-upload-alt"}),O.a.translator.trans("fof-upload.forum.file_list.release_to_upload"))),m("div",{className:"Modal-header"},m("h3",{className:"App-titleControl App-titleControl--text"},O.a.translator.trans("fof-upload.forum.media_manager"))),this.alertAttrs&&m("div",{className:"Modal-alert"},m(Alert,this.alertAttrs)),m("div",{className:"Modal-body"},O.a.forum.attribute("userFileListVisibility")?i(7).components.UserFileList.component({user:this.attrs.user,selectable:!0,onFileSelect:this.onFileSelect.bind(this),selectedFiles:this.selectedFiles,restrictFileType:this.restrictFileType}):E.a.component({user:this.attrs.user,onFileSelect:this.onFileSelect.bind(this),selectedFiles:this.selectedFiles,restrictFileType:this.restrictFileType,onSelect:this.onSelect.bind(this)})),m("div",{className:"Modal-footer"},O.a.forum.attribute("userFileListVisibility")?n.a.component({id:"currentFilesButton",onclick:this.showAllFiles.bind(this),className:"Button Button--primary"},O.a.translator.trans("digi-media-manager.forum.current_files")):n.a.component({id:"allFilesButton",onclick:this.showAllFiles.bind(this),className:"Button Button--secundary"},O.a.translator.trans("digi-media-manager.forum.all_files")),m(n.a,{onclick:this.hide.bind(this),className:"Button"},O.a.translator.trans("fof-upload.forum.buttons.cancel")),m(n.a,{onclick:this.onSelect.bind(this),disabled:0===this.selectedFiles.length||!this.multiSelect&&this.selectedFiles.length>1,className:"Button Button--primary"},O.a.translator.trans("fof-upload.forum.file_list.confirm_selection_btn",{fileCount:this.selectedFiles.length})))))})),i(7).components.FileManagerModal.prototype.showAllFiles=function(){O.a.forum.data.attributes.userFileListVisibility^=!0}}))}]);
//# sourceMappingURL=forum.js.map